---
alwaysApply: false
---
# ğŸ“ Engineering Guidelines â€“ Base Libraries

TÃ i liá»‡u nÃ y Ä‘á»‹nh nghÄ©a **nguyÃªn táº¯c thiáº¿t káº¿ & coding rule** Ã¡p dá»¥ng cho toÃ n bá»™ base libraries trong tá»• chá»©c.  
Má»¥c tiÃªu: Ä‘áº£m báº£o **consistency, maintainability, scalability** vÃ  **developer experience**.

---

## ğŸ¯ NguyÃªn táº¯c xuyÃªn suá»‘t
1. **Contract-first**: abstraction tÃ¡ch rá»i implementation.  
2. **Starter nhá» gá»n**: khÃ´ng Ã©p project kÃ©o dependency thá»«a.  
3. **Backward compatibility**: tuÃ¢n thá»§ semantic versioning, trÃ¡nh breaking change.  
4. **Observability first**: má»i module tÃ­ch há»£p metrics + tracing.  
5. **Testability**: module nÃ o cÅ©ng Ä‘i kÃ¨m test utilities.  

---

## 1. Contract-first
- LuÃ´n define **interface** hoáº·c **abstract class** cho má»i feature.  
- Implementation Ä‘á»ƒ á»Ÿ module riÃªng (`impl-*`).  
- CÃ¡c project chá»‰ Ä‘Æ°á»£c depend vÃ o **contract module**, khÃ´ng depend trá»±c tiáº¿p vÃ o implementation.  
- Náº¿u cÃ³ nhiá»u implementation â†’ cung cáº¥p **SPI (Service Provider Interface)** qua `META-INF/services`.  

âŒ TrÃ¡nh:  
- Code logic gáº¯n cháº·t vá»›i thÆ° viá»‡n ngoÃ i.  
- `*Util` class vá»«a chá»©a business logic vá»«a gá»i external lib.  

---

## 2. Starter nhá» gá»n
- Starter chá»‰ chá»©a **AutoConfiguration** + **properties binding**.  
- KhÃ´ng add dependency ngoÃ i trá»« khi báº¯t buá»™c.  
- Sá»­ dá»¥ng `@ConditionalOnClass`, `@ConditionalOnMissingBean` Ä‘á»ƒ trÃ¡nh Ã©p buá»™c project pháº£i dÃ¹ng lib cá»¥ thá»ƒ.  
- Chia starter nhá» theo domain: `starter-core`, `starter-cache`, `starter-security`, `starter-observability`.  

âŒ TrÃ¡nh:  
- Má»™t starter â€œall-in-oneâ€ kÃ©o táº¥t cáº£ dependency.  

---

## 3. Backward Compatibility
- TuÃ¢n thá»§ **Semantic Versioning (SemVer)**:  
  - **MAJOR**: thay Ä‘á»•i breaking.  
  - **MINOR**: thÃªm feature, váº«n backward-compatible.  
  - **PATCH**: bug fix.  
- KhÃ´ng rename/xÃ³a public API trong minor/patch release.  
- Deprecate báº±ng `@Deprecated` + message rÃµ rÃ ng.  
- Má»—i release pháº£i cÃ³ **CHANGELOG.md**.  

âŒ TrÃ¡nh:  
- Breaking change vÃ¬ lÃ½ do â€œrefactor cho Ä‘áº¹p hÆ¡nâ€.  

---

## 4. Observability First
- Má»i module pháº£i expose **metrics** (Micrometer) + **tracing hooks** (OpenTelemetry).  
- Logging qua **SLF4J facade**, khÃ´ng hardcode log4j/logback.  
- KhÃ´ng swallow exception, luÃ´n log context (userId, traceId).  
- CorrelationId/TraceId pháº£i Ä‘Æ°á»£c propagate xuyÃªn suá»‘t.  

âŒ TrÃ¡nh:  
- Log thiáº¿u context.  
- Metrics/tracing chá»‰ thÃªm vÃ o má»™t sá»‘ module, khÃ´ng Ä‘á»“ng bá»™.  

---

## 5. Testability
- Má»—i module cáº§n cÃ³ **test utilities**: mock, stub, in-memory impl.  
- Sá»­ dá»¥ng **JUnit5 + AssertJ + Testcontainers** cho integration test.  
- Coverage tá»‘i thiá»ƒu **80% line + branch**.  
- Starter module pháº£i cÃ³ **Spring Boot integration test**.  
- Naming convention:  
  - Unit test: `*Test.java`.  
  - Integration test: `*IT.java`.  

âŒ TrÃ¡nh:  
- Viáº¿t library mÃ  chá»‰ test trong project chÃ­nh.  
- Test phá»¥ thuá»™c external service mÃ  khÃ´ng cÃ³ Testcontainers.  

---

## 6. Coding Convention
- **Java 17+**.  
- Theo **Google Java Style Guide**, custom rules:  
  - Indent 4 spaces.  
  - Max line length: 120 chars.  
  - Package naming: `io.github.org.base.module`.  
- Static analysis: **Checkstyle + SpotBugs**.  
- Lombok: chá»‰ dÃ¹ng cho DTO/POJO, khÃ´ng dÃ¹ng trong core contract.  
- KhÃ´ng Ä‘á»ƒ â€œmagic numberâ€ trong code â†’ define constant.  
- **Documentation**:  
  - Public API pháº£i cÃ³ Javadoc.  
  - VÃ­ dá»¥ usage cho contract trong `docs/usage.md`.  

---

## 7. Definition of Done (DoD)
- âœ… Code + Unit test + Integration test.  
- âœ… SonarQube pass + coverage â‰¥ 80%.  
- âœ… Artifact Ä‘Æ°á»£c publish (Nexus/Maven Central).  
- âœ… Docs cáº­p nháº­t (Javadoc + usage guide).  

---

## ğŸ“Œ References
- [Google Java Style Guide](https://google.github.io/styleguide/javaguide.html)  
- [Semantic Versioning](https://semver.org/)  
- [Spring Boot AutoConfiguration](https://docs.spring.io/spring-boot/docs/current/reference/html/auto-configuration.html)  
- [OpenTelemetry](https://opentelemetry.io/)  
- [Micrometer Metrics](https://micrometer.io/)  
